



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Dango Lifecycle Hooks</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#django-lifecycle-hooks" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="Dango Lifecycle Hooks" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cached</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Dango Lifecycle Hooks
            </span>
            <span class="md-header-nav__topic">
              
                Intro
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/rsinger86/django-lifecycle/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    rsinger86/django-lifecycle
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="Dango Lifecycle Hooks" class="md-nav__button md-logo">
      
        <i class="md-icon">cached</i>
      
    </a>
    Dango Lifecycle Hooks
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/rsinger86/django-lifecycle/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    rsinger86/django-lifecycle
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="." title="Intro" class="md-nav__link md-nav__link--active">
      Intro
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="hooks_and_conditions/" title="Lifecycle Moments & Conditions" class="md-nav__link">
      Lifecycle Moments & Conditions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="fk_changes/" title="Watching ForeignKey Changes" class="md-nav__link">
      Watching ForeignKey Changes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="advanced/" title="Advanced" class="md-nav__link">
      Advanced
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/rsinger86/django-lifecycle/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="django-lifecycle-hooks">Django Lifecycle Hooks<a class="headerlink" href="#django-lifecycle-hooks" title="Permanent link">&para;</a></h1>
<p><a href="https://pypi.python.org/pypi/django-lifecycle"><img alt="Package version" src="https://badge.fury.io/py/django-lifecycle.svg" /></a>
<a href="https://img.shields.io/pypi/status/django-lifecycle.svg/"><img alt="Python versions" src="https://img.shields.io/pypi/status/django-lifecycle.svg" /></a></p>
<h1 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h1>
<p>This project provides a <code>@hook</code> decorator as well as a base model or mixin to add lifecycle hooks to your Django models. Django's built-in approach to offering lifecycle hooks is <a href="https://docs.djangoproject.com/en/2.0/topics/signals/">Signals</a>. However, in the projects I've worked on, my team often finds that Signals introduce unnesseary indirection and are at odds with Django's "fat models" approach of including related logic in the model class itself*. </p>
<p>In short, you can write model code that looks like this:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">django_lifecycle</span> <span class="kn">import</span> <span class="n">LifecycleModel</span><span class="p">,</span> <span class="n">hook</span>


<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">LifecycleModel</span><span class="p">):</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">])</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">AuthUser</span><span class="p">)</span>

    <span class="nd">@hook</span><span class="p">(</span><span class="s1">&#39;before_update&#39;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">has_changed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_content_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="nd">@hook</span><span class="p">(</span><span class="s1">&#39;after_update&#39;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">was</span><span class="o">=</span><span class="s2">&quot;draft&quot;</span><span class="p">,</span> <span class="n">is_now</span><span class="o">=</span><span class="s2">&quot;published&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">send_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;An article has published!&quot;</span><span class="p">)</span>
</pre></div>


<p>Instead of overriding <code>save</code> and <code>__init___</code> in a clunky way that hurts readability:</p>
<div class="codehilite"><pre><span></span>    <span class="c1"># same class and field declarations as above ...</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_contents</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span><span class="p">:</span>
            <span class="n">send_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s2">&quot;An article has published!&quot;</span><span class="p">)</span>
</pre></div>


<p>*This is not to say Signals are never useful; my team prefers to use them for incidental concerns not related to the business domain, like cache invalidation.</p>
<h1 id="table-of-contents">Table of Contents:<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h1>
<div class="codehilite"><pre><span></span>pip install django-lifecycle
</pre></div>


<h1 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h1>
<ul>
<li>Python (3.3+)</li>
<li>Django (1.8+)</li>
</ul>
<h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h1>
<p>Either extend the provided abstract base model class:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">django_lifecycle</span> <span class="kn">import</span> <span class="n">LifecycleModel</span><span class="p">,</span> <span class="n">hook</span>


<span class="k">class</span> <span class="nc">YourModel</span><span class="p">(</span><span class="n">LifecycleModel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>


<p>Or add the mixin to your Django model definition:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django_lifecycle</span> <span class="kn">import</span> <span class="n">LifecycleModelMixin</span><span class="p">,</span> <span class="n">hook</span>


<span class="k">class</span> <span class="nc">YourModel</span><span class="p">(</span><span class="n">LifecycleModelMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>


<p>:exclamation: <em>If you are using <strong>Django 1.8 or below</strong> and want to extend the base model, you also have to add <code>django_lifecycle</code> to <code>INSTALLED_APPS</code></em>.</p>
<p>Great, now we can start adding lifecycle hooks! Let's do a few examples that illustrate the ability to not only hook into certain events, but to add basic conditions that can replace the need for boilerplate conditional code. </p>
<h1 id="changelog">Changelog <a id="changelog"></a><a class="headerlink" href="#changelog" title="Permanent link">&para;</a></h1>
<h2 id="050-september-2019">0.5.0 (September 2019)<a class="headerlink" href="#050-september-2019" title="Permanent link">&para;</a></h2>
<ul>
<li>Adds <code>was_not</code> condition</li>
<li>Allow watching changes to FK model field values, not just FK references</li>
</ul>
<h2 id="042-july-2019">0.4.2 (July 2019)<a class="headerlink" href="#042-july-2019" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixes missing README.md issue that broke install.</li>
</ul>
<h2 id="041-june-2019">0.4.1 (June 2019)<a class="headerlink" href="#041-june-2019" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixes <a href="https://github.com/andrewgodwin/urlman">urlman</a>-compatability.</li>
</ul>
<h2 id="040-may-2019">0.4.0 (May 2019)<a class="headerlink" href="#040-may-2019" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixes <code>initial_value(field_name)</code> behavior - should return value even if no change. Thanks @adamJLev!</li>
</ul>
<h2 id="032-february-2019">0.3.2 (February 2019)<a class="headerlink" href="#032-february-2019" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixes bug preventing hooks from firing for custom PKs. Thanks @atugushev!</li>
</ul>
<h2 id="031-august-2018">0.3.1 (August 2018)<a class="headerlink" href="#031-august-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixes m2m field bug, in which accessing auto-generated reverse field in <code>before_create</code> causes exception b/c PK does not exist yet. Thanks @garyd203!</li>
</ul>
<h2 id="030-april-2018">0.3.0 (April 2018)<a class="headerlink" href="#030-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Resets model's comparison state for hook conditions after <code>save</code> called.</li>
</ul>
<h2 id="024-april-2018">0.2.4 (April 2018)<a class="headerlink" href="#024-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixed support for adding multiple <code>@hook</code> decorators to same method.</li>
</ul>
<h2 id="023-april-2018">0.2.3 (April 2018)<a class="headerlink" href="#023-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Removes residual mixin methods from earlier implementation.</li>
</ul>
<h2 id="022-april-2018">0.2.2 (April 2018)<a class="headerlink" href="#022-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Save method now accepts <code>skip_hooks</code>, an optional boolean keyword argument that controls whether hooked methods are called.</li>
</ul>
<h2 id="021-april-2018">0.2.1 (April 2018)<a class="headerlink" href="#021-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Fixed bug in <code>_potentially_hooked_methods</code> that caused unwanted side effects by accessing model instance methods decorated with <code>@cache_property</code> or <code>@property</code>. </li>
</ul>
<h2 id="020-april-2018">0.2.0 (April 2018)<a class="headerlink" href="#020-april-2018" title="Permanent link">&para;</a></h2>
<ul>
<li>Added Django 1.8 support. Thanks @jtiai!</li>
<li>Tox testing added for Python 3.4, 3.5, 3.6 and Django 1.8, 1.11 and 2.0. Thanks @jtiai!</li>
</ul>
<h1 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h1>
<p>Tests are found in a simplified Django project in the <code>/tests</code> folder. Install the project requirements and do <code>./manage.py test</code> to run them.</p>
<h1 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h1>
<p>See <a href="LICENSE.md">License</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="examples/" title="Examples" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Examples
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>